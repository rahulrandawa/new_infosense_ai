<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>Infosense AI Admin</title>
    <meta content="" name="description">
    <meta content="" name="keywords">

    <!-- Favicons -->
    <link href="assets/img/favicon.png" rel="icon">
    <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect">
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
        rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
    <link href="assets/vendor/quill/quill.snow.css" rel="stylesheet">
    <link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet">
    <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
    <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet">

    <!-- Template Main CSS File -->
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="assets/css/infosense.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.css">


</head>


<body>

    <!-- ======= Header ======= -->
    <header id="header" class="header fixed-top d-flex align-items-center">

        <div class="d-flex align-items-center justify-content-between">
            <a href="dashboard.html" class="logo d-flex align-items-center">
                <img src="assets/img/infosense Ai-Logo.png" alt="infosense Ai-Logo">
                <!-- <span class="d-none d-lg-block">Infosense AI</span> -->
            </a>
            <i class="bi bi-list toggle-sidebar-btn"></i>
        </div><!-- End Logo -->

        <div class="search-bar">
            <form class="search-form d-flex align-items-center" method="POST" action="#">
                <input type="text" name="query" placeholder="Search" title="Enter search keyword">
                <button type="submit" title="Search"><i class="bi bi-search"></i></button>
            </form>
        </div><!-- End Search Bar -->

        <nav class="header-nav ms-auto">
            <ul class="d-flex align-items-center">

                <li class="nav-item d-block d-lg-none">
                    <a class="nav-link nav-icon search-bar-toggle " href="#">
                        <i class="bi bi-search"></i>
                    </a>
                </li><!-- End Search Icon-->





                <li class="nav-item dropdown pe-3">

                    <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
                        <img alt="Profile" class="rounded-circle" id="adminProfileImage">
                        <span class="d-none d-md-block dropdown-toggle ps-2" id="adminName"></span>
                    </a><!-- End Profile Iamge Icon -->

                    <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
                        <li>
                            <a class="dropdown-item d-flex align-items-center" href="users-profile.html">
                                <i class="bi bi-person"></i>
                                <span>My Profile</span>
                            </a>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>

                        <li>
                            <hr class="dropdown-divider">
                        </li>

                        <li>
                            <a class="dropdown-item d-flex align-items-center" href="#">
                                <i class="bi bi-box-arrow-right"></i>
                                <span onclick="logOut();">Sign Out</span>
                            </a>
                        </li>

                    </ul><!-- End Profile Dropdown Items -->
                </li><!-- End Profile Nav -->

            </ul>
        </nav><!-- End Icons Navigation -->

    </header><!-- End Header -->
    <aside id="sidebar" class="sidebar">

        <ul class="sidebar-nav" id="sidebar-nav">

            <li class="nav-item">
                <a class="nav-link collapsed" href="dashboard.html">
                    <i class="bi bi-grid"></i>
                    <span>Dashboard</span>
                </a>
            </li><!-- End Dashboard Nav -->
            <!-- <li class="nav-item">
                <a class="nav-link collapsed" href="case-studies.html">
                    <i class="bi bi-grid"></i>
                    <span>Case studies</span>
                </a>
            </li> -->
            <!-- End Dashboard Nav -->
            <li class="nav-item">
                <a class="nav-link " href="success_story.html">
                    <i class="bi bi-grid"></i>
                    <span>Success Stories</span>
                </a>
            </li><!-- End Dashboard Nav -->

            <li class="nav-item">
                <a class="nav-link collapsed" href="blog.html">
                    <i class="bi bi-grid"></i>
                    <span>Blog</span>
                </a>
            </li><!-- End Dashboard Nav -->

            <li class="nav-item">
                <a class="nav-link collapsed" href="users-profile.html">
                    <i class="bi bi-person"></i>
                    <span>Profile</span>
                </a>
            </li><!-- End Profile Page Nav -->

            <li class="nav-item">
                <a class="nav-link collapsed" data-bs-target="#components-nav" data-bs-toggle="collapse" href="#">
                    <i class="bi bi-menu-button-wide"></i><span>CMS</span><i class="bi bi-chevron-down ms-auto"></i>
                </a>
                <ul id="components-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
                    <!-- <li>
            <a href="about-us.html">
              <i class="bi bi-circle"></i><span>about us</span>
            </a>
          </li> -->
                    <li>
                        <a href="privacy-policy.html">
                            <i class="bi bi-circle"></i><span>Privacy Policy</span>
                        </a>
                    </li>

                    <li>
                        <a href="terms_use.html">
                            <i class="bi bi-circle"></i><span>Terms of use</span>
                        </a>
                    </li>

                    <li>
                        <a href="cookies.html">
                            <i class="bi bi-circle"></i><span>Cookie Policy </span>
                        </a>
                    </li>



                </ul>
            </li>



        </ul>

    </aside><!-- End Sidebar-->

    <main id="main" class="main">
        <div>
            <div class="row col-12 ">
                <div class="col-6">
                    <h3>View Success Stories</h3>
                    <nav>
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="dashboard.html">Dashboard</a></li>

                            <li class="breadcrumb-item active">View Success Stories</li>
                        </ol>
                    </nav>
                </div><!-- End Page Title -->
                <div class="col-6">
                    <div id="addButton"> <a href="success_story.html" class="btn btn-primary"><i
                                class="bi bi-arrow-left-short"></i> Back</a></div>
                </div>
            </div><!-- End Page Title -->
        </div>


        <section class="section">
            <div class="row">
                <div class="col-lg-12">
                    <div class="card">
                        <div class="card-body">
                            <div class="alert alert-success" role="alert" id="updateBlogMessage" style="display: none;">
                            </div>
                            <form action="" id="caseStudyForm" method="post" enctype="multipart/form-data">
                                <input type="hidden" id="blogId" />
                                <div class="col-12">
                                    <label for="inputNanme4" class="form-label"><strong>Title</strong></label>
                                    <input type="text" class="form-control" id="title">
                                </div>

                                <div class="col-12">
                                    <label for=""><strong>Category</strong></label>
                                    <select id="category" class="form-control">
                                        <option selected value="">Select Category</option>
                                    </select>
                                    <div class="error" id="errorCategory"></div>
                                </div>

                                <!-- <div class="col-12">
                                    <div class="form-group mt-5">
                                        <label for=""><strong>Image</strong></label>
                                        <input type="file" class="form-control" name="files" id="blogImage" multiple />
                                    </div>
                                    <div id="divImageMediaPreview"></div>
                                </div> -->

                                <div class="col-12">
                                    <div class="form-group mt-5">
                                      <label for=""><strong>Image</strong></label>
                                      <input type="file" class="form-control" name="files" id="blogImage" />
                                    </div>
                                    <div class="error" id="errorImg"></div>
                                    <div style="margin: 14px;">
                                      <img class="file-upload-image profile-user-img" src="" alt="blogImgPreview" id="blogImgPreview" style="display: none;" width="100px;" height="100px;">
                                    </div>
                                  </div>

                                <div class="col-12">

                                    <label for="inputEmail4" class="form-label"><strong>Description</strong></label>


                                    <div class="quill-editor-full">
                                        <textarea class="form-control" style="height: 300px"></textarea>
                                    </div>
                                </div>

                                <div class="col-12"><button type="button" class="btn btn-primary"
                                        onclick="updateStory();">Update</button></div>

                            </form>

                        </div>
                    </div>

                </div>
            </div>
        </section>

    </main><!-- End #main -->
    <!-- <div id="footerDiv"></div> -->
    <footer id="footer" class="footer">
        <div class="copyright">
            &copy; Copyright <strong><span>Infosense AI</span></strong>. All Rights Reserved
        </div>

    </footer>

    <!-- Vendor JS Files -->
    <script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/chart.js/chart.umd.js"></script>
    <script src="assets/vendor/echarts/echarts.min.js"></script>
    <script src="assets/vendor/quill/quill.min.js"></script>
    <script src="assets/vendor/simple-datatables/simple-datatables.js"></script>
    <script src="assets/vendor/tinymce/tinymce.min.js"></script>
    <script src="assets/vendor/php-email-form/validate.js"></script>

    <script src="assets/vendor/datatable/chart.umd.js"></script>
    <script src="assets/vendor/chart.js/chart.umd.js"></script>
    <script src="assets/vendor/extra-libs/DataTables/datatables.min.js"></script>
    <script src="assets/vendor/datatable/datatable-basic.init.js"></script>
    <!-- Template Main JS File -->
    <script src="assets/js/main.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script>
        var token = localStorage.getItem("loginToken");
        console.log("token", token);
        if (!token) {
            window.location.href = "index.html";
        }
        getAdminDetails();
        function getAdminDetails() {
            jQuery.support.cors = true;
            var url = "http://infosense.tech:8000/admin/data";
            $.ajax({
                url: url,
                type: "GET",
                success: function (response) {
                    var res = JSON.parse(JSON.stringify(response));
                    var admin = res.data[0];
                    console.log(admin);
                    var fullname = admin.firstName + " " + admin.lastName;
                    $('#adminName').text(fullname ? fullname : "Admin")
                    $('#adminProfileImage').attr('src', admin.image)
                },
                error: function (err) {
                    var error = JSON.parse(err);

                    console.log(JSON.stringify(error));

                },
            });
        }


        function logOut() {
            jQuery.support.cors = true;
            var url = "http://infosense.tech:8000/admin/logout   ";
            $.ajax({
                url: url,
                type: "GET",
                success: function (response) {
                    console.log(response);
                    localStorage.clear()

                    var token = localStorage.getItem("loginToken");
                    console.log("token", token);
                    window.location.href = "index.html";
                },
                error: function (err) {
                    console.log(err);

                },
            });
        }

        var search = window.location.search
        console.log(search);
        const urlParams = new URLSearchParams(search);
        const slug = urlParams.get('id');
        console.log("urlParams", slug);

        $('#blogId').val(slug)

        $("#blogImage").change(function () {
            if (typeof (FileReader) != "undefined") {
                var dvPreview = $("#divImageMediaPreview");
                dvPreview.html("");
                $($(this)[0].files).each(function () {
                    var file = $(this);
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        var img = $("<img />");
                        img.attr("style", "width: 150px; height:100px; padding: 10px");
                        img.attr("src", e.target.result);
                        dvPreview.append(img);
                    }
                    reader.readAsDataURL(file[0]);
                });
            } else {
                alert("This browser does not support HTML5 FileReader.");
            }
        });

        getSuccessCategoryDetail();
    function getSuccessCategoryDetail() {
      console.log("categories")
      jQuery.support.cors = true;
      var url = "http://infosense.tech:8000/story/success-categories-details";
      $.ajax({
        url: url,
        type: "GET",
        success: function (response) {
          var res = JSON.parse(JSON.stringify(response));
          console.log("resresres",res.successCategoryData);

            $.each(res.successCategoryData, function(key, value) {
                $("#category").append('<option value="' + value._id + '">' + value.name + '</option>');
            });

        //   var fullname = admin.firstName + " " + admin.lastName;
        //   $('#adminName').text(fullname ? fullname : "Admin")
        //   $('#adminProfileImage').attr('src', admin.image)
        },
        error: function (err) {
          var error = JSON.parse(err);
          console.log(JSON.stringify(error));
        },
      });
    }

    // -------------Add Image Preview------------------------------
    function read(input) {
      $('#blogImgPreview').show();
      if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function (e) {
          $('#blogImgPreview').attr('src', e.target.result);
        }
        reader.readAsDataURL(input.files[0]);
      }
    }
    $("#blogImage").change(function () {
      read(this);
    });

    $('#blogImage').bind('change', function () {
      var ext = $('#blogImage').val().split('.').pop().toLowerCase();

      console.log("ext", ext)

      if (ext == "png" || ext == "jpg" || ext == "jpeg") {
        $("#errorImg").hide();

        console.log("yes extenstion")

      } else {
        $('#blogImgPreview').hide();
        $('#error1').show();
        $("#errorImg").show().text("Image formate should be png,jpg,jpeg");
        console.log("no extenstion")
      }
    });


    $(document).ready(function () {
      $('input[id="title"]').on('keyup', function () {
        if (title != '' || title != 0) {
          $("#errorTitle").hide();
        }
      });
    });


        getAllCaseStudy(slug);
        function getAllCaseStudy(slug) {
            console.log("fun", slug);
            jQuery.support.cors = true;
            var url = "http://infosense.tech:8000/story/story-detail/" + slug;
            $.ajax({
                url: url,
                type: "GET",
                success: function (response) {
                    console.log(response.data);
                    console.log("successcategoryId",response.data.successcategoryId);

                    $("#category").val(response.data.successcategoryId);

                    $('#title').val(response.data.title);
                    new Quill(".quill-editor-full", {
                        modules: {
                            toolbar: [
                                [{
                                    font: []
                                }, {
                                    size: []
                                }],
                                ["bold", "italic", "underline", "strike"],
                                [{
                                    color: []
                                },
                                {
                                    background: []
                                }
                                ],
                                [{
                                    script: "super"
                                },
                                {
                                    script: "sub"
                                }
                                ],
                                [{
                                    list: "ordered"
                                },
                                {
                                    list: "bullet"
                                },
                                {
                                    indent: "-1"
                                },
                                {
                                    indent: "+1"
                                }
                                ],
                                ["direction", {
                                    align: []
                                }],
                                ["link", "image", "video"],
                                ["clean"]
                            ]
                        },
                        theme: "snow"
                    }).clipboard.dangerouslyPasteHTML(response.data.description);
                    
                    
                    $('#blogImgPreview').show()
                    $('#blogImgPreview').attr("src", response.data.image)

                },
                error: function (err) {
                    console.log(err);

                },
            });
        }

        function updateStory() {
        
        var title = $('#title').val();
        var category = $('#category').val();
  
        var content = $('.quill-editor-full').html();
        var file = $('#blogImage')[0].files[0];
        console.log("filefile", file);

        const slug = urlParams.get('id');
        console.log("urlParams", slug);

        
  
        var check_quillDescription = new Quill(".quill-editor-full").getText(); // check data avaiable in ckeditor or not
        console.log("check_quillDescription", check_quillDescription);
  
        var quill_description = new Quill(".quill-editor-full").root.innerHTML; //desc with html
  
        var title_valid = false;
        var description_valid = false;
        var category_valid = false;
  
        if (title == '' || title == 0) {
          $("#errorTitle").show().text("Enter Title");
          var title_valid = false;
        } else {
          var title_valid = true;
          $("#errorTitle").hide();
        }
        
  
        if (category == '' || category == 0) {
          $("#errorCategory").show().text("Select Category");
          var category_valid = false;
        } else {
          var category_valid = true;
          $("#errorCategory").hide();
        }
  
        if (check_quillDescription == '' || check_quillDescription == 0) {
          $("#errorDesc").show().text("Enter Description");
          var description_valid = false;
        } else {
          var description_valid = true;
          $("#errorDesc").hide();
        }
  
  
        if (description_valid == false || description_valid == false || category_valid == false) {
          console.log("login error")
          $(window).scrollTop(0);
          return false;
        }

  
        $("#errorTitle").hide();
        $("#errorDesc").hide();
        $("#errorImg").hide();
  
        let formData = new FormData();
        formData.append("title", title);
        formData.append("description", quill_description);
        formData.append("successcategoryId", category);
        if (file) {
          formData.append("image", file);
        }
        
        var url = "http://infosense.tech:8000/story/updateStory/"+ slug;
        $.ajax({
          url: url,
          method: "PUT",
          type: "PUT",
          enctype: 'multipart/form-data',
          data: formData,
          cache: false,
          contentType: false,
          processData: false,
          crossDomain: true,
          success: function (response) {
            console.log("Update");
            console.log(response);
            toastr.success('Success stories update successfully');
            // $("#errorMessage").show().text(response.message);
            // console.log(response);
            // $("#errorMessage").fadeTo(2000, 500).slideUp(500, function () {
            //   $("#errorMessage").hide();
            // });
          //   location.reload()
          },
          error: function (err) {
            toastr.success("Somethings went wrong");
            // var error = JSON.parse(err.responseText);
            console.log(err);
  
          },
        });
  
      }
    </script>
</body>


</html>